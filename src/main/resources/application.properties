spring.application.name=BankingApp
spring.jpa.hibernate.ddl-auto=update
spring.jpa.open-in-view=false

# ----------------------------------------
# 1. CONEXÃO À BASE DE DADOS (POSTGRESQL)
# ----------------------------------------
# O teu docker run: -e POSTGRES_DB=bankingapp -p 5432:5432
spring.datasource.url=${DB_URL}

# O teu docker run: -e POSTGRES_PASSWORD=root root
spring.datasource.password=${DB_PASSWORD}

# IMPORTANTE: O teu docker run NÃO definiu um POSTGRES_USER.
# Quando isso acontece, o user por defeito do PostgreSQL é "postgres".
spring.datasource.username=postgres

# (Opcional) Mostra o SQL no terminal. Ótimo para debug.
spring.jpa.show-sql=true

#------------

# ----------------------------------------
# 3. CONEXÃO AO CACHE (REDIS)
# ----------------------------------------
spring.data.redis.host=localhost
spring.data.redis.port=6379

# ----------------------------------------
# 4. CONFIGURAÇÃO DE EMAIL (PARA OTPs)
# ----------------------------------------
# NOTA: Para isto funcionar, tens de criar uma conta gratuita no Mailtrap.io
# e copiar as tuas credenciais (username/password) para aqui.
# Isto "apanha" os emails em vez de os enviar de verdade. Perfeito para testes.
spring.mail.host=sandbox.smtp.mailtrap.io
spring.mail.port=2525
spring.mail.username=${MAILTRAP_USERNAME}
spring.mail.password=${MAILTRAP_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true




#JWT token
jwt.secret=${JWT_SECRET}

jwt.expiration-ms=900000

# ----------------------------------------
# CONFIGURAÇÃO DE RATE LIMITING (BUCKET4J)
# ----------------------------------------

# Ativa o filtro de rate limiting
bucket4j.filters[0].enabled=true

# Usa o Redis como "cofre" dos tokens (baldes)
bucket4j.filters[0].cache-name=buckets

# Identifica os utilizadores pelo seu endereço IP
bucket4j.filters[0].filter-method=servlet

# --- Regra 1: Proteger o endpoint de REGISTO (abuso) ---
bucket4j.filters[0].url=^/auth/register.*
bucket4j.filters[0].strategy=first
bucket4j.filters[0].rate-limits[0].bandwidths[0].capacity=5
bucket4j.filters[0].rate-limits[0].bandwidths[0].time=1
bucket4j.filters[0].rate-limits[0].bandwidths[0].unit=minutes
# O que isto significa: O endpoint /auth/register permite 5 pedidos por 1 minuto (por IP).

# --- Regra 2: Proteger o endpoint de LOGIN (brute-force) ---
bucket4j.filters[1].enabled=true
bucket4j.filters[1].cache-name=buckets
bucket4j.filters[1].filter-method=servlet
bucket4j.filters[1].url=^/auth/login.*
bucket4j.filters[1].strategy=first
bucket4j.filters[1].rate-limits[0].bandwidths[0].capacity=10
bucket4j.filters[1].rate-limits[0].bandwidths[0].time=1
bucket4j.filters[1].rate-limits[0].bandwidths[0].unit=minutes
# O que isto significa: O endpoint /auth/login permite 10 pedidos por 1 minuto (por IP).

# --- Regra 3: Proteger o "FORGOT PASSWORD" (abuso de email) ---
bucket4j.filters[2].enabled=true
bucket4j.filters[2].cache-name=buckets
bucket4j.filters[2].filter-method=servlet
bucket4j.filters[2].url=^/auth/forgot-password.*
bucket4j.filters[2].strategy=first
bucket4j.filters[2].rate-limits[0].bandwidths[0].capacity=3
bucket4j.filters[2].rate-limits[0].bandwidths[0].time=1
bucket4j.filters[2].rate-limits[0].bandwidths[0].unit=minutes
# O que isto significa: O endpoint /auth/forgot-password permite 3 pedidos por 1 minuto (por IP).


